<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="application-name" content="Raspberry Pi Hub">
		<meta name="theme-color" content="#4EA2E4">
		<link rel="stylesheet" href="/styles.css" type="text/css" media="screen" />
		<link rel="manifest" href="/manifest.json">
		<link rel="shortcut icon" href="/favicon.ico">
		<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript">
    
    // Load the Visualization API and the piechart package.
    google.charts.load('current', {'packages':['corechart']});
	</head>
	<body>
		<div class="full">
			<div id="foo" class="header">
				<div class="enjoy-css">Welcome to the Raspberry Pi Home Hub </div>
				<div class="dayscont">
					<div class="days">
						<div id="waa">Show</div>
						<div class="select-style">
							<select id="days">
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="14">14</option>
								<option value="24">24</option>
								<option value="30">30</option>
								<option value="60">60</option>
								<option value="90">90</option>
								<option value="180">180</option>
								<option value="365">265</option>
							</select>
						</div>
						<input id="daysbut" type="button" value="Days" onclick="getChart();">
						<input class="select-style" id="fromdate" type="date">
					</div>
					<div class="timer">
						<a id="timer" href="/timer">Timer</a>
					</div>
				</div>
				%s
			</div>
			<div id="chart_container">
				<div id="spinner" class="spinner" ><img id="img-spinner" src="spinner.gif" alt="Loading" style="display:block; margin:auto;"/></div>
				
				<div id="linechart_material" style="width:100%%; height:100%%"></div>
			</div>
		</div>

		
		<script>
			var paramDays = %s;
			var from = "%s";
			var to = "%s";
			if (from && to) {
				function getChart() {
					var text="/chart?from="
					text += from;
					text += "&to=";
					text += to;
					$.loadScript(text, function(){
						$("#spinner").show(); drawChart(); $("#spinner").hide();
					});
				};
			} else if (from && days > 0) {
			function getChart() {
					var text="/chart?from="
					text += from;
					text += "&days=";
					text += days;
					$.loadScript(text, function(){
						$("#spinner").show(); drawChart(); $("#spinner").hide();
					});
				};
			} else if (paramDays > 0) {
				function getChart() {
					var text="/chart?days="
					text += paramDays;
					$.loadScript(text, function(){
						$("#spinner").show(); drawChart(); $("#spinner").hide();
					});
				};
			} else {
				function getChart() {
					var sel = document.getElementById("days");
					days = (sel.options[sel.selectedIndex].value) 
					var date = document.getElementById("fromdate").value;
					text="/chart";
					if (date && days > 0) {
						text += "?from=";
						text += date;
						text+="&days=";
						text+=days;
					} else if (days > 0) {
						text+="?days="; text+=days;
					} 
					$.loadScript(text, function(){
						$("#spinner").show(); drawChart(); $("#spinner").hide();
					});
				};
			}
			jQuery.loadScript = function (url, callback) { jQuery.ajax({  url: url, dataType: 'script', success: callback, async: true }); }
			google.load('visualization', '1.0', {'packages':['corechart'], "callback": getChart});
			
			$(window).resize(function() {
				if(this.resizeTO) clearTimeout(this.resizeTO);
				this.resizeTO = setTimeout(function() {
					$(this).trigger('resizeEnd');
				}, 100);
			});

			//redraw graph when window resize is completed  
			$(window).on('resizeEnd', function() {
			var sausage = "height:" + (window.innerHeight - document.getElementById('foo').offsetHeight - 40) + "px";

			document.getElementById('chart_container').setAttribute("style",sausage);
				drawChart();
			});

			var sausage = "height:" + (window.innerHeight - document.getElementById('foo').offsetHeight - 40) + "px";

			document.getElementById('chart_container').setAttribute("style",sausage);
		</script>
	</body>
</html>
